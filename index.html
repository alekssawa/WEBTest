<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css"/>
  <title>GPS Tracker</title>
<script src="https://www.openlayers.org/en/v4.6.5/build/ol.js"></script>
</head>

<body>
  <div id="map2" style="width: 800px; height: 800px"></div>
  <p id="address">Адрес: </p>
  <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
  <script>
    let map;
    let marker;
    function initMap(lat, lon)
    {
    	if (!map)
    	{
    		map = L.map('map2').setView([lat, lon], 13);
    		L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
    		{
    			maxZoom: 18,
    			attribution: ''
    		}).addTo(map);
    		marker = L.marker([lat, lon]).addTo(map);
    	}
    	else
    	{
    		map.setView([lat, lon], 13);
    		marker.setLatLng([lat, lon]);
    	}
    }

    function getAddress(lat, lon)
    {
    	const url = `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}&zoom=18&addressdetails=1`;

    	fetch(url)
    		.then(response => response.json())
    		.then(data =>
    		{
    			const address = data.display_name;
    			document.getElementById('address').innerHTML = `Адрес: ${address}`;
    		})
    		.catch(error => console.error('Ошибка при получении адреса:', error));
    }
    function updateLocation()
    {
    	if (navigator.geolocation)
    	{
    		navigator.geolocation.getCurrentPosition(position =>
    		{
    			const lat = position.coords.latitude;
    			const lon = position.coords.longitude;

    			initMap(lat, lon);
    			getAddress(lat, lon);
                console.log(lat,lon);
    		}, error =>
    		{
    			console.error('Ошибка при получении координат:', error);
    		});
    	}
    	else
    	{
    		console.log('Геолокация не поддерживается вашим браузером.');
    	}
    }

    setInterval(updateLocation, 2000);

    updateLocation();
  </script>

</body>
</html>

